// Custom Adaptive Scrolling
// author: Stepych - http://csscode.ru
// Website:  https://github.com/exewebru/scroll
// version: 1.0 beta 1
function Scroll(e,t){var n=this;if(typeof e=="object")var t=e,e=e.horizontal?".scroll-horizontal":".scroll";else if(!e)var e=".scroll";var r=$(e);n.dott=[];n.touch=!1;n.border=[!0,!0];n.config=$.extend({cls:["scroll-wrap","scroll-pane","scroll-track","scroll-drag"],drag_old:!1,step:5,start:!1,horizontal:!1,iDeviceSupport:!0},t);if(!n.config.iDeviceSupport)if(window.navigator.userAgent.indexOf("iPhone")!==-1||window.navigator.userAgent.indexOf("iPad")!==-1||window.navigator.userAgent.indexOf("iPod")!==-1){r.css("overflow","auto");return}if("ontouchstart"in window){r.addClass("touch");n.config.start=!0;n.touch=!0}n.config.horizontal?n.tracking={scrollWidth:null,paneWidth:null,dragWidth:null,dragLeft:0,dragRight:null}:n.tracking={scrollHeight:null,paneHeight:null,dragHeight:null,dragTop:0,dragBot:null};r.trigger("scrolling.load",{node:r,config:n.config,tracking:n.tracking});$("body").on("mouseenter.scroll",e,function(e){$(this).trigger("scrolling.mouseenter",{node:this,config:n.config,events:e,tracking:n.tracking})});$("body").on("mouseleave.scroll",e,function(e){$(this).trigger("scrolling.mouseleave",{node:this,config:n.config,events:e,tracking:n.tracking})});$("body").on("mouseover.scroll touchstart",e,function(t){function a(){var e=r.children(),i=e.filter("."+n.config.cls[2]),s=e.children().filter("."+n.config.cls[1]),o=i.children(),u=r.children().filter("."+n.config.cls[0]);if(n.config.horizontal){n.tracking.scrollWidth=r.width();var a=s.children(),f=s.width();a.each(function(e,t){var n=$(t).width();n>f&&(f=n)});s.width(f);n.tracking.paneWidth=f;n.tracking.dragWidth=n.tracking.paneWidth/n.tracking.scrollWidth;n.tracking.dragWidth=Math.round(n.tracking.scrollWidth/n.tracking.dragWidth);if(!(n.tracking.scrollWidth<n.tracking.paneWidth)){r.addClass("scroll-off");return!1}r.addClass("hover").removeClass("scroll-off");o.width(n.tracking.dragWidth);n.dragPosition=function(e){e=e!=undefined?e:n.tracking.dragLeft;n.tracking.dragLeft=e;n.tracking.dragRight=Math.abs(e+n.tracking.dragWidth-n.tracking.scrollWidth);n.tracking.dragRight=n.tracking.dragRight==1?0:n.tracking.dragRight;n.tracking.dragLeft==0&&!n.border[1]&&r.trigger("scrolling.left",{node:this,config:n.config,events:t,tracking:n.tracking});n.tracking.dragRight==0&&!n.border[1]&&r.trigger("scrolling.right",{node:this,config:n.config,events:t,tracking:n.tracking});n.tracking.dragLeft==0||n.tracking.dragRight==0?n.border[1]=!0:n.border[1]=!1}}else{n.tracking.scrollHeight=r.height();n.tracking.paneHeight=s.height();n.tracking.dragHeight=n.tracking.paneHeight/n.tracking.scrollHeight;n.tracking.dragHeight=Math.round(n.tracking.scrollHeight/n.tracking.dragHeight);if(!(n.tracking.scrollHeight<n.tracking.paneHeight)){r.addClass("scroll-off");return!1}r.addClass("hover").removeClass("scroll-off");o.height(n.tracking.dragHeight);n.dragPosition=function(e){e=e!=undefined?e:n.tracking.dragTop;n.tracking.dragTop=e;var i=Math.abs(e+n.tracking.dragHeight-n.tracking.scrollHeight);n.tracking.dragBot=i==1?0:i;n.tracking.dragTop==0&&!n.border[0]&&r.trigger("scrolling.top",{node:this,config:n.config,events:t,tracking:n.tracking});n.tracking.dragBot==0&&!n.border[0]&&r.trigger("scrolling.bottom",{node:this,config:n.config,events:t,tracking:n.tracking});n.tracking.dragTop==0||n.tracking.dragBot==0?n.border[0]=!0:n.border[0]=!1}}n.dragPosition();r.trigger("scrolling.mouseover",{node:this,config:n.config,events:t,tracking:n.tracking});u.on("mousewheel.scroll DOMMouseScroll.scroll touchmove",function(e){var t=null,r=$(this);if(e.type=="mousewheel")try{t=-(e.originalEvent.wheelDelta/n.config.step)}catch(e){}else if(e.type=="DOMMouseScroll")try{t=n.config.step*2*e.originalEvent.detail}catch(e){}else if(e.type=="touchmove"&&e.originalEvent){var i=1,u=e.originalEvent.pageY,a=e.originalEvent.pageX;n.config.horizontal?a>n.dott[0]?i=-1:i=1:u>n.dott[1]?i=-1:i=1;t=i*n.config.step*2}if(t){if(n.config.horizontal){r.scrollLeft(t+r.scrollLeft());var f=n.tracking.paneWidth/n.tracking.scrollWidth,l=n.tracking.paneWidth-n.tracking.scrollWidth,c=s.position().left;c=Math.round(-c/f);o.css("margin-left",c+"px")}else{r.scrollTop(t+r.scrollTop());var h=n.tracking.paneHeight/n.tracking.scrollHeight,l=n.tracking.paneHeight-n.tracking.scrollHeight,c=s.position().top;c=Math.round(-c/h);o.css("margin-top",c+"px")}n.dragPosition(c);r.parent().trigger("scrolling.scroll",{node:this,config:n.config,events:e,tracking:n.tracking});if(n.config.horizontal){if(r.scrollLeft()===0)return;if(r.scrollLeft()===l)return}else{if(r.scrollTop()===0)return;if(r.scrollTop()===l)return}return!1}})}function f(){r.addClass("runned");if(n.config.drag_old)var e='<div class="'+n.config.cls[2]+'"><div class="'+n.config.cls[3]+'">'+n.config.drag_old+"</div></div>";else var e='<div class="'+n.config.cls[2]+'"><div class="'+n.config.cls[3]+'">'+"</div></div>";r.wrapInner('<div class="'+n.config.cls[0]+'"><div class="'+n.config.cls[1]+'"></div></div>');r.append(e);r.css("overflow","hidden");var i=r.find("."+n.config.cls[0]);i.scrollTop(0);i.scrollLeft(0);r.trigger("scrolling.scroll",{node:r,config:n.config,events:t,tracking:n.tracking});r.trigger("scrolling.create",{node:r,config:n.config,events:t,tracking:n.tracking});a()}t.preventDefault();var r=$(this),i=r.find("."+n.config.cls[1]).length;if(n.touch){t.originalEvent==undefined&&(t.originalEvent={pageX:r.offset().left,pageY:r.offset().top});n.dott[0]=t.originalEvent.pageX;n.dott[1]=t.originalEvent.pageY}$(t.target).parents(e).length>1&&(r=r.find(t.target).closest(e));if(i){var s=r.children(),o=s.children().filter("."+n.config.cls[1]),u=r.children().filter("."+n.config.cls[0]);u.height()>o.height()&&(r=$(this))}i?a():f()});$("body").on("scrolling.set",e,function(e){var t=$(this),r=t.find(">."+n.config.cls[0]),i=r.next().find(">."+n.config.cls[3]),s=r.find(">."+n.config.cls[1]),o={X:e.scrollX||0,Y:e.scrollY||0,duration:e.duration||0,easing:e.easing||"swing"},u=function(e,t){var n=s.position()[e],o=r[t](),u=s[t]()/o;n=Math.round(-n/u);i.css("margin-"+e,n+"px")};if(o.X){if(o.X.indexOf("+")!=-1){o.X=~~o.X.match(/[0-9]+/)[0];o.X=r.scrollTop()+o.X}else if(o.X.indexOf("-")!=-1){o.X=~~o.X.match(/[0-9]+/)[0];o.X=r.scrollTop()-o.X}r.animate({scrollLeft:~~o.X},{queue:!1,easing:o.easing,duration:~~o.duration,step:function(e,n){u("left","width");t.trigger("scrolling.scroll")}})}if(o.Y){if(o.Y.indexOf("+")!=-1){o.Y=~~o.Y.match(/[0-9]+/)[0];o.Y=r.scrollTop()+o.Y}else if(o.Y.indexOf("-")!=-1){o.Y=~~o.Y.match(/[0-9]+/)[0];o.Y=r.scrollTop()-o.Y}r.animate({scrollTop:~~o.Y},{queue:!1,easing:o.easing,duration:~~o.duration,step:function(){u("top","height");t.trigger("scrolling.scroll")}})}});$("body").on("mouseout.scroll touchend",e,function(e){$(this).removeClass("hover");$(this).find("."+n.config.cls[0]).off("mousewheel.scroll DOMMouseScroll.scroll");$(this).trigger("scrolling.mouseout",{node:this,config:n.config,events:e,tracking:n.tracking})});$("body").on({mousedown:function(e){var t=$(e.target),r=t.hasClass(n.config.cls[3])?t:t.closest("."+n.config.cls[3]).length?t.closest("."+n.config.cls[3]):!1;if(!r)return;var i=r.parent().parent(),s,o,u=null;i.addClass("mousedown");-[1]||i.attr("unselectable","on");$("html").attr("onselectstart","return false").addClass("user-select-none");var a=n.config.horizontal?r.width():r.height(),f=i.children().children().filter("."+n.config.cls[1]),l=i.children().filter("."+n.config.cls[0]),c=n.config.horizontal?l.width():l.height(),h=n.config.horizontal?i.offset().left:i.offset().top,p=c-a;$("body").on("mousemove.scroll",function(e){e.preventDefault();var t=n.config.horizontal?e.pageX:e.pageY,o=parseInt(n.config.horizontal?r.css("margin-left"):r.css("margin-top")),d=t-h;s==null&&(s=d-o);var v=d-s,m=o+a;if(v<0)v=0;else if(m>=c){v=p;u==null&&(u=d);u>d&&(v-=1)}n.config.horizontal?r.css("margin-left",v+"px"):r.css("margin-top",v+"px");n.config.horizontal?l.scrollLeft(v*f.width()/c):l.scrollTop(v*f.height()/c);n.dragPosition(v);i.trigger("scrolling.mousemove",{node:this,config:n.config,events:e,tracking:n.tracking});i.trigger("scrolling.scroll",{node:this,config:n.config,events:e,tracking:n.tracking})});r.parent().parent().trigger("scrolling.mousedown",{node:this,config:n.config,events:e,tracking:n.tracking})},mouseup:function(e){$(this).trigger("scrolling.mouseup",{node:this,config:n.config,events:e,tracking:n.tracking})}},e);$("body").on("mouseup",function(e){r.removeClass("mousedown");-[1]||$(this).removeAttr("unselectable");$("html").removeAttr("onselectstart").removeClass("user-select-none");$(this).off("mousemove.scroll")});if(n.config.start){r.trigger("mouseover").trigger("mouseout");n.touch&&r.trigger("touchstart")}r.trigger("scrolling.loaded",{node:r,config:n.config,tracking:n.tracking})};
